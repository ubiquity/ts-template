import {
  getCredits,
  decreaseCredits,
  checkURN,
  getStripePotalSessionUrl,
} from "../popup/utils/api";
import { analytics } from "../utils/analytics/analytics";
import { isSalesNav } from "../utils/domain";

function init(): void {
  initMessage();
  initTabs();
}

function initMessage() {
  chrome.runtime.onMessage.addListener(function (
    message,
    sender,
    sendResponse
  ) {
    const { command } = message;
    const PNG_PREFIX = `data:image/png;base64,`;

    switch (command) {
      case "getCredits":
        getCredits().then((data) => sendResponse(data));
        return true;
      case "decreaseCredits":
        decreaseCredits(message.amount).then((data) => sendResponse(data));
        return true;
      case "checkURN":
        checkURN(message.urn).then((result) => sendResponse(result));
        return true;
      case "goToUpgradePage":
        getStripePotalSessionUrl().then((url) => {
          if (url) {
            chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
              const active = tabs[0].id;
              if (!active) {
                throw new Error(`No active tab found`);
              }
              chrome.tabs.create({ active: true, url });
            });
          }
        });
      case "darkMode":
        chrome.browserAction.setIcon({
          path: {
            "128": `${PNG_PREFIX}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`, // "../../assets/icons/source/ob-ffffff128x128.png",
            "48": `${PNG_PREFIX}iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQflBxkGDxZirTG4AAAEAUlEQVRYw7XXWYjWVRjH8d87jmljMlQoJZZRthNFq5XSRhdCaiuJ0YK002ZBBRoElQoWedFCXtSFC0YLrUZElBUZLRSVZGobRUpjWVnqjM776WL+86bzLr2N4/nf/DnP+f++zznnOc9z/slubiW7GdCaluwKo5RyklJ9e8mcjEm5n/IteTZvZmZG11FoyZq4xXb9besc6/oG9k7XtOapnJPJScrpjAaT/bdJS4YmSR7Nz5mcH9NdtfD7Z1CSF7KoJDkzz2fvbM09+SCDmgCUc1WmJ/k056Uj+1U51Z2pmZvWdGRKVkQM8ihYrFWaeA7wObpcUcc+ysfgQSXp6TrSt9jsQg1DqhCYC16xV9/RIkrmgFUOEZWP7gTv2rcRQsTJ1mOjs6tHipigA91u7lHu7R7pA5TdVumuLT/EEvC4QTX9H+5VsNw+O9hFTLUVqx3aEHC+v/Gdo2rKxw224W9TdrKLaPM8eFipFkLEPt4Bd1fPU8ThVhfhMqSPXcR4G9Dh9DqrG7foxof2qynf6oni+J1YpSCixXzwnD1rChzia2w1rY4D59kEZtfcRxGHWYMtLt15QBF+D4EXtNWM/hHeA18aU3MXi2EzlLHCyB0HiTjNL/jVhDrHaybY7rqd/W/tfSn1dC7MxTktp+TKzEuRmiTJ0MzIiCSLsiZ3ZXiVi225LEnydpb2qNUPxItsxjeO6PVDxCW2YK3D3N0ge24ysWEuEDHU0+ARLTus7/som2Gsz23ye81nkwUG9wWU+iKSnJoXMyIbc0GWF913ZF5KWZHJ6c7Y+g7m+3SkccYv4mUeeNGwIrbWYouLm8q1fRRL1YgkB2dZDk9XpmdxWjI/Nyd5JrfnzKLQVLdSNmRZOpuoV4UfN+nGR0YY71d0GOcO5QYbPFuzN5Qi6yxH2f1FhprnaN83kK93vGrviCSZkiVpy5a0ZnBWZ2LaM6lKoZxRuSpt6c6NWVBXrs4chlhceNft1rpbOksZb2hvXAtrI06yDrxTq86JOM5P+PM/jleDrZ6Dzc6vk/0HexI8VX28mkWMscpSo13Uc9/oY53oT/zkuH7IV+ZwieNdb53xVdm13Rvg3vpVvDnEgVbipX8vKUX/tbbhM6P7KV+ROshX6HJ1r6cF9gt0mb4L8hXEdbZhpYN3CM8HwGuGDwRguGVgfiWBn+Bn/OHcXZSvIM6wAb/13ObsYSFY0De2+g/oTeCvaxeT/IUfHDMA8hXEGF9guxu1ewvM6nd41gTElTqxysO68In9B0i+gui9Wm5Hp8sHUL6CGGd9kV9f7immAw2I+8BGZw2wfAUxyid4rPrfYOAQ06ys/jcYSMAw43rOc7OtySLai/j/n7X0Zy7/y6vd3f4Bnf3dgLZV5qEAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDctMjFUMTA6MzQ6MDcrMDA6MDDjf5GsAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA3LTIxVDEwOjM0OjA3KzAwOjAwkiIpEAAAAABJRU5ErkJggg==`, // "../../assets/icons/source/ob-ffffff48x48.png",
            "32": `${PNG_PREFIX}iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQflBxkGDxZirTG4AAACiElEQVRIx6WUS0iUYRSG33+coRnBG4UkmVnQouhmNAkWbcqCLohBoaJEWVirrFVGLbJFKUWbFlGK2SKMzF0UUnZBXCQkpqXVyiwHi4KyJsd0nhYz/jP/OM6M9Z3d4ZznXL73+wz0f8culxJl+GRXUqTT4KpWyC8jZiqyaVCNOqUFZjmEbOqzq1uVcsqnP7NAUJJcku5rswqkIAClKk1eNRg41agy3dGlWUbxq0In1KliGUo2Yxy6rCLdVJUQbj7zkTUoqmXRwzjFEd49/GSEPAKjcBFoxoGliWDoOaCFeZi9IzLpAmrRNCCXAbzsigJYxwhfyLeki7NAL9khgDgGPCYdy5Jx0ATUBWJMrxsPU1SaXoRIpwM4GhG6k18MstTiS6YVeEhKWL8IsRsvb8gNuBEijUchqGkHmOA726fT7ebI7WpVhapUM33VKtFWdahH5aZCkEsn5VCzOmaoBbEeD6O4g5WW8BovpbQReYZYHWrfHkZ5qQadUbUOySepSit1S8+UoqeWWja9VX9UxSIW08c4RYgNjOKhgAwySA+zDFyhRUsK6T/oOqwbeq4S1atcF+RTmaYilFWru4r+bBAilXamaGOMV2yji2E+BG2I38ALFlrlNhOxgx/AJEdwkmNaNvm8Y4L9MdKDADuNQHtAKGFWA9wLbEBxEGvpp5TlFv2tYphvbIqTHgxOws1xnpBpVrdzHbiCERdgPq4m4LQJKGSM96GeEkFs4SufyEOIFB4A1db7jwcwqANu40QcxE8n8xNMNxE59DLBPrLoxcfeOaSbe6hgkm6uAS045wSwfB1+RkNf2lwRG/EA9Qld3yxjnGeAZf+QbiIWURj7+ozYiPhhtkR6iVXlLxKkUSoUrf7UAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTA3LTIxVDEwOjM0OjA3KzAwOjAw43+RrAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0wNy0yMVQxMDozNDowNyswMDowMJIiKRAAAAAASUVORK5CYII=`, // "../../assets/icons/source/ob-ffffff32x32.png",
            "16": `${PNG_PREFIX}iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQflBxkGDxZirTG4AAABF0lEQVQoz22QsSvEcRiHn6/7UQw3XV1RMkkdihtMLKhLdimM/ogT3WSQGAzHYJKSs1guLIZjN9iUScpERN3gHoMfdz953+V938/Tp95PMAMEWkvqdJACGhDcJ8czAWM5ootDxkgDWW4jquTZ5iF2+WSRPKdUkX62qGJk2RWJO+uFBRGDO5ZNIQ5bczgGVt2Np4I35uR7WXPPSBzy2gXHnXDaK4siQYBuDtjgnF1e+aAPSfFOiSeIAsIjByyTZpAqEfc0qHPEEwTa4udOkE2OeSMiUKDAWyIZcdKK3SJmPHPG32B+gOC866bEovu2J4AY6fXSKQesOdKUQxMBlpjjhTtKCanFo9OKN/b8sU8go84m5dAK/Hf+AvYwoG0nj84cAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTA3LTIxVDEwOjM0OjA3KzAwOjAw43+RrAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0wNy0yMVQxMDozNDowNyswMDowMJIiKRAAAAAASUVORK5CYII=`, // "../../assets/icons/source/ob-ffffff16x16.png",
          },
        });
        return true;
      case "lightMode":
        /*
          base64 ob-00000016x16.png > ob-00000016x16.txt
          base64 ob-00000032x32.png > ob-00000032x32.txt
          base64 ob-00000048x48.png > ob-00000048x48.txt
          base64 ob-000000128x128.png > ob-000000128x128.txt
        */
        chrome.browserAction.setIcon({
          path: {
            "128": `${PNG_PREFIX}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`, // "../../assets/icons/source/ob-000000128x128.png",
            "48": `${PNG_PREFIX}iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQflBxkGDxX7pGACAAADiklEQVRYw+3XW4jUZRgG8N+sa9rasmSsqFgbatqBSDqaKVnRheCpVBKjFKk0ScuEEjQIKhW20Iss8iIvPGBUoh2MkCgtUiopNMnUykhUWs1y03XXnXm7GXV3Z/6z4+50EfT8797n/z3Pd3y/9+O/jpQy0an2GaSS+ZTFamQ6KF/mHZ9YoF+CQpl9zNEsOvgddoOZBfhGj5Zb6R5jkdEoCgz2PEKZ7mC5Q8b6TbrNH+X66IINVqcw0nqXOu0523UpwiBjmun41mh1eud0Km2yJcrVGWcbdLFcCGuUFzXzl9spNHk4ge/rGyG8fN76Gj8Lp9xflMESIXzgkrxsymIh7DGgZfgZIXzusnblb3VEOO7uBH6EOiFtdutwL9uFjKfake9mrRBeT1itSh8KYYuebanJTgt7XVXQYLyTwi+uTeAfd0Y4aVwuVWG9EJYW2Ko9bRXC/AR+sL3Z7dItHz3cUaHOHYkGc6SFr/TOy5Z7I3v8bs7fvMwyIbzr4rz8AD8Kp01JsB+tXgiLkmd4kH1CgwfycCmvCGGDirxtq30hhO/VKIC5MsI2vXKYYX4XjhmR0HKBEJrNaDtvrbHKRMPcZqraVvHu5qrGavs8qzInxVd4EHxmnXYwwSnhJ1e3ik7SIOw3yPwC2bPeqPbk6e4tIbyqrMX8filkzDXQTvX+zPvVW6Fr7tLl4nYbVTvuPluykXlqpWwzVtrAAp07oK79EZBSK4SNeoBB9gsNJhbTuJgR0N8mgzWZbo0yy8zG2542MnvR5NM5apPG4o2fkBa+Vm24Y0KdoebJFFjgRUXdhufQ0xYh48Vshqp1nQMF5BOPV7LrOGtVaFCuq71GqTImZ/dn9DVNhbRZVlzo6nSzJtu7tCcT/1ooI2xWdaHycIvDQtiaeM8NcVA4Uczxyo/FwinjE9iu3hTCytzjVSxq7LFOPxPy1hujnBAOGtJReZjkRjMdNjyHqbJZCM93Rh6usFt4L6dIecwZ4Tv9OmtwpR+EJo+0sd0lNJneWXmY4YywW/8WsZeE8JHKUhhU2iSEZecS+E0OCX+5txTycKejwh/Zau4iq4SwoshatgicTeAfq8IYfwu/ur5U8lBjl9BsliqfCmFhKeVhqkZhj6WahB36lNrgbGnZLDR6qNTyMNSRbH59P3uZlhwvCOG4u/4defraIbxW1Euug5hid+LboCToYWiLgux/lAL/AE65kpLwSsbLAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTA3LTIxVDEwOjM0OjA3KzAwOjAw43+RrAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0wNy0yMVQxMDozNDowNyswMDowMJIiKRAAAAAASUVORK5CYII=`, // "../../assets/icons/source/ob-00000048x48.png",
            "32": `${PNG_PREFIX}iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQflBxkGDxX7pGACAAACUklEQVRIx73UXUjVdxgH8M/RIx0DSymkyKxd7GKjt405ocVuVhu0jWhQaCRRFrarua5mrIu8aUqxmy5iKeUuRlHrbmzIZi9EFxMW9l67clZiUbG5uY6pvy7S4zl/j69B3+fq+f6e7/f3/F54eEnE5AtTrE2Kyx1rcNgbhsQmlAY5bmn2lfmp7YIgx9W4dtUSkp6NYxLkysdP1ljNsEEwx1x9mmISmm1x0sFxjjKkypcu2ihmdqomzyEbHFcDZR64a8U47S902VMbI+yn/nXfWyPpN4IWeVkN9gtOmJXBFbskqB8llrqpz8dZ5Kvc91B5hN0n6FCSTn0u+E1hpDDPMUFDhC3TbVB1JlmoTbA7Urref255LYOb7bTgFwXRZj/R54alacxcv2Yx3abf3z4cSeOphVanValRl2IqfKDNZVtTPyTIt0eeFm3Z7vtt3XqUDWdLXNen0hkhEp2Wj4riaQZ/aPK1WjskUeNN3zuvwLmMbXLcds04WOyqpzbgHT26rVakSGFaFMnPlET//05HXVCh0VYHJG0xmFp7cYB6p0yAOVoNOqPXFWtd0uWv4ej0v+B3C0yCj/wjGLBLQmkqSpS7o9/myeTENQtax3yUOsGP0RvIjpWuqfR6BrdMl8fem4qcXGW+cFZxWlffCb6dZG5l4Jhgbypbp9efkZ4mwfseuTc8MAr8LKidjpyYBsEPEthuyEXzpmdAqQ79NlmoQ9Jn05VDlQHtjghOSMzE4MXoGNIzZqRNGe/qFjRO9Hy5ExrcU6jYHk9m2gGLrJu5+NXgOXCnspbzv0k+AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTA3LTIxVDEwOjM0OjA3KzAwOjAw43+RrAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0wNy0yMVQxMDozNDowNyswMDowMJIiKRAAAAAASUVORK5CYII=`, // "../../assets/icons/source/ob-00000032x32.png",
            "16": `${PNG_PREFIX}iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQflBxkGDxX7pGACAAAA/klEQVQoz5XOsSuEARzG8c9775tiMCl1Siapi8JwEwvqEv4AsfkDzERmiWI4BpOUnMVyYaGOzXDFH2DQlYW4KAOvweuIKN/p1/N7fs/zCzQh8JXYszohXglsyrgTiJN1pMG2rEY0u4wU9VpxnaS8mNRrX1Gs3bIikbzZWnyzIzkQWJMXQpeSrsQwZz2ZcsoyH3fzNkTodGZCn35DTs2o/Z+2ZdGhdQ+etImFHi248d6hKmVcbMyFwJ1bFXkVSCUle2JLdlVFAjk5Vd8YUJAGTQ4Mf8hhzXAlNOpEbFpk1asftDo2qENJ96cYfjHci03JOrfjF+oVlLX4gx4j/scb5nY/LOIDm5QAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDctMjFUMTA6MzQ6MDcrMDA6MDDjf5GsAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA3LTIxVDEwOjM0OjA3KzAwOjAwkiIpEAAAAABJRU5ErkJggg==`, // "../../assets/icons/source/ob-00000016x16.png",
          },
        });
        return true;
      case "trackPopupClick":
        const trackContent = { ...message.content };
        trackContent.timestamp = new Date();
        analytics.track(trackContent);
        return true;
      default:
        break;
    }
  });
}

function initTabs(): void {
  chrome.tabs.onActivated.addListener(function (activeInfo) {
    const { tabId } = activeInfo;
    chrome.tabs.get(tabId, function (tabInfo) {
      if (tabInfo.url && isSalesNav(tabInfo.url)) {
        syncCredits();
      }
    });
  });
}

function syncCredits(): void {
  getCredits().then((userCredits) => {
    chrome.storage.local.set({ userCredits });
  });
}

init();
